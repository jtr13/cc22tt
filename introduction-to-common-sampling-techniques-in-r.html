<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 51 Introduction to common sampling techniques in r | Community Contributions for EDAV Fall 2022 Tues/Thurs</title>
<meta name="description" content="Yuanyi Hu #load packages: library(survey) library(srvyr) library(tidyverse) library(sampling)  51.0.1 Motivation This semester, we have learned a lot of valuable techniques for analyzing the...">
<meta name="generator" content="bookdown 0.31 with bs4_book()">
<meta property="og:title" content="Chapter 51 Introduction to common sampling techniques in r | Community Contributions for EDAV Fall 2022 Tues/Thurs">
<meta property="og:type" content="book">
<meta property="og:description" content="Yuanyi Hu #load packages: library(survey) library(srvyr) library(tidyverse) library(sampling)  51.0.1 Motivation This semester, we have learned a lot of valuable techniques for analyzing the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 51 Introduction to common sampling techniques in r | Community Contributions for EDAV Fall 2022 Tues/Thurs">
<meta name="twitter:description" content="Yuanyi Hu #load packages: library(survey) library(srvyr) library(tidyverse) library(sampling)  51.0.1 Motivation This semester, we have learned a lot of valuable techniques for analyzing the...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.0/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.26/datatables.js"></script><link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script><script src="libs/dygraphs-1.1.1/shapes.js"></script><script src="libs/moment-2.8.4/moment.js"></script><script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><script src="libs/d3-4.13.0/d3.min.js"></script><script src="libs/forceNetwork-binding-0.4/forceNetwork.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><script src="libs/d3v3-3.5.3/./d3v3.min.js"></script><link href="libs/d3heatmapcore-0.0.0/heatmapcore.css" rel="stylesheet">
<script src="libs/d3heatmapcore-0.0.0/heatmapcore.js"></script><script src="libs/d3v3-tip-0.6.6/index.js"></script><script src="libs/d3heatmap-binding-0.9.0/d3heatmap.js"></script><script src="libs/threejs-111/three.min.js"></script><script src="libs/threejs-111/Detector.js"></script><script src="libs/threejs-111/Projector.js"></script><script src="libs/threejs-111/CanvasRenderer.js"></script><script src="libs/threejs-111/TrackballControls.js"></script><script src="libs/threejs-111/StateOrbitControls.js"></script><script src="libs/scatterplotThree-binding-0.3.3/scatterplotThree.js"></script><script src="libs/rglWebGL-binding-0.110.3/rglWebGL.js"></script><link href="libs/rglwidgetClass-0.110.3/rgl.css" rel="stylesheet">
<script src="libs/rglwidgetClass-0.110.3/rglClass.src.js"></script><script src="libs/rglwidgetClass-0.110.3/utils.src.js"></script><script src="libs/rglwidgetClass-0.110.3/buffer.src.js"></script><script src="libs/rglwidgetClass-0.110.3/subscenes.src.js"></script><script src="libs/rglwidgetClass-0.110.3/shaders.src.js"></script><script src="libs/rglwidgetClass-0.110.3/textures.src.js"></script><script src="libs/rglwidgetClass-0.110.3/projection.src.js"></script><script src="libs/rglwidgetClass-0.110.3/mouse.src.js"></script><script src="libs/rglwidgetClass-0.110.3/init.src.js"></script><script src="libs/rglwidgetClass-0.110.3/pieces.src.js"></script><script src="libs/rglwidgetClass-0.110.3/draw.src.js"></script><script src="libs/rglwidgetClass-0.110.3/controls.src.js"></script><script src="libs/rglwidgetClass-0.110.3/selection.src.js"></script><script src="libs/rglwidgetClass-0.110.3/rglTimer.src.js"></script><script src="libs/rglwidgetClass-0.110.3/pretty.src.js"></script><script src="libs/rglwidgetClass-0.110.3/axes.src.js"></script><script src="libs/rglwidgetClass-0.110.3/animation.src.js"></script><!--html_preserve--><script type="text/plain" id="rgl-vertex-shader">
    #line 2 1
    // File 1 is the vertex shader
    #ifdef GL_ES
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif
    #endif

    attribute vec3 aPos;
    attribute vec4 aCol;
    uniform mat4 mvMatrix;
    uniform mat4 prMatrix;
    varying vec4 vCol;
    varying vec4 vPosition;

    #ifdef NEEDS_VNORMAL
    attribute vec3 aNorm;
    uniform mat4 normMatrix;
    varying vec4 vNormal;
    #endif

    #if defined(HAS_TEXTURE) || defined (IS_TEXT)
    attribute vec2 aTexcoord;
    varying vec2 vTexcoord;
    #endif

    #ifdef FIXED_SIZE
    uniform vec3 textScale;
    #endif

    #ifdef FIXED_QUADS
    attribute vec3 aOfs;
    #endif

    #ifdef IS_TWOSIDED
    #ifdef HAS_NORMALS
    varying float normz;
    uniform mat4 invPrMatrix;
    #else
    attribute vec3 aPos1;
    attribute vec3 aPos2;
    varying float normz;
    #endif
    #endif // IS_TWOSIDED

    #ifdef FAT_LINES
    attribute vec3 aNext;
    attribute vec2 aPoint;
    varying vec2 vPoint;
    varying float vLength;
    uniform float uAspect;
    uniform float uLwd;
    #endif


    void main(void) {
      
    #ifndef IS_BRUSH
    #if defined(NCLIPPLANES) || !defined(FIXED_QUADS) || defined(HAS_FOG)
      vPosition = mvMatrix * vec4(aPos, 1.);
    #endif
      
    #ifndef FIXED_QUADS
      gl_Position = prMatrix * vPosition;
    #endif
    #endif // !IS_BRUSH
      
    #ifdef IS_POINTS
      gl_PointSize = POINTSIZE;
    #endif
      
      vCol = aCol;
      
    #ifdef NEEDS_VNORMAL
      vNormal = normMatrix * vec4(-aNorm, dot(aNorm, aPos));
    #endif
      
    #ifdef IS_TWOSIDED
    #ifdef HAS_NORMALS
      /* normz should be calculated *after* projection */
      normz = (invPrMatrix*vNormal).z;
    #else
      vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));
      pos1 = pos1/pos1.w - gl_Position/gl_Position.w;
      vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));
      pos2 = pos2/pos2.w - gl_Position/gl_Position.w;
      normz = pos1.x*pos2.y - pos1.y*pos2.x;
    #endif
    #endif // IS_TWOSIDED
      
    #ifdef NEEDS_VNORMAL
      vNormal = vec4(normalize(vNormal.xyz/vNormal.w), 1);
    #endif
      
    #if defined(HAS_TEXTURE) || defined(IS_TEXT)
      vTexcoord = aTexcoord;
    #endif
      
    #if defined(FIXED_SIZE) && !defined(ROTATING)
      vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);
      pos = pos/pos.w;
      gl_Position = pos + vec4(aOfs*textScale, 0.);
    #endif
      
    #if defined(IS_SPRITES) && !defined(FIXED_SIZE)
      vec4 pos = mvMatrix * vec4(aPos, 1.);
      pos = pos/pos.w + vec4(aOfs,  0.);
      gl_Position = prMatrix*pos;
    #endif
      
    #ifdef FAT_LINES
      /* This code was inspired by Matt Deslauriers' code in 
       https://mattdesl.svbtle.com/drawing-lines-is-hard */
      vec2 aspectVec = vec2(uAspect, 1.0);
      mat4 projViewModel = prMatrix * mvMatrix;
      vec4 currentProjected = projViewModel * vec4(aPos, 1.0);
      currentProjected = currentProjected/currentProjected.w;
      vec4 nextProjected = projViewModel * vec4(aNext, 1.0);
      vec2 currentScreen = currentProjected.xy * aspectVec;
      vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;
      float len = uLwd;
      vec2 dir = vec2(1.0, 0.0);
      vPoint = aPoint;
      vLength = length(nextScreen - currentScreen)/2.0;
      vLength = vLength/(vLength + len);
      if (vLength > 0.0) {
        dir = normalize(nextScreen - currentScreen);
      }
      vec2 normal = vec2(-dir.y, dir.x);
      dir.x /= uAspect;
      normal.x /= uAspect;
      vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);
      gl_Position = currentProjected + offset;
    #endif
      
    #ifdef IS_BRUSH
      gl_Position = vec4(aPos, 1.);
    #endif
    }
    </script><script type="text/plain" id="rgl-fragment-shader">
    #line 2 2
    // File 2 is the fragment shader
    #ifdef GL_ES
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif
    #endif
    varying vec4 vCol; // carries alpha
    varying vec4 vPosition;
    #if defined(HAS_TEXTURE) || defined (IS_TEXT)
    varying vec2 vTexcoord;
    uniform sampler2D uSampler;
    #endif

    #ifdef HAS_FOG
    uniform int uFogMode;
    uniform vec3 uFogColor;
    uniform vec4 uFogParms;
    #endif

    #if defined(IS_LIT) && !defined(FIXED_QUADS)
    varying vec4 vNormal;
    #endif

    #if NCLIPPLANES > 0
    uniform vec4 vClipplane[NCLIPPLANES];
    #endif

    #if NLIGHTS > 0
    uniform mat4 mvMatrix;
    #endif

    #ifdef IS_LIT
    uniform vec3 emission;
    uniform float shininess;
    #if NLIGHTS > 0
    uniform vec3 ambient[NLIGHTS];
    uniform vec3 specular[NLIGHTS]; // light*material
    uniform vec3 diffuse[NLIGHTS];
    uniform vec3 lightDir[NLIGHTS];
    uniform bool viewpoint[NLIGHTS];
    uniform bool finite[NLIGHTS];
    #endif
    #endif // IS_LIT

    #ifdef IS_TWOSIDED
    uniform bool front;
    varying float normz;
    #endif

    #ifdef FAT_LINES
    varying vec2 vPoint;
    varying float vLength;
    #endif

    void main(void) {
      vec4 fragColor;
    #ifdef FAT_LINES
      vec2 point = vPoint;
      bool neg = point.y < 0.0;
      point.y = neg ? (point.y + vLength)/(1.0 - vLength) :
                     -(point.y - vLength)/(1.0 - vLength);
    #if defined(IS_TRANSPARENT) && defined(IS_LINESTRIP)
      if (neg && length(point) <= 1.0) discard;
    #endif
      point.y = min(point.y, 0.0);
      if (length(point) > 1.0) discard;
    #endif // FAT_LINES
      
    #ifdef ROUND_POINTS
      vec2 coord = gl_PointCoord - vec2(0.5);
      if (length(coord) > 0.5) discard;
    #endif
      
    #if NCLIPPLANES > 0
      for (int i = 0; i < NCLIPPLANES; i++)
        if (dot(vPosition, vClipplane[i]) < 0.0) discard;
    #endif
        
    #ifdef FIXED_QUADS
        vec3 n = vec3(0., 0., 1.);
    #elif defined(IS_LIT)
        vec3 n = normalize(vNormal.xyz);
    #endif
        
    #ifdef IS_TWOSIDED
        if ((normz <= 0.) != front) discard;
    #endif
        
    #ifdef IS_LIT
        vec3 eye = normalize(-vPosition.xyz/vPosition.w);
        vec3 lightdir;
        vec4 colDiff;
        vec3 halfVec;
        vec4 lighteffect = vec4(emission, 0.);
        vec3 col;
        float nDotL;
    #ifdef FIXED_QUADS
        n = -faceforward(n, n, eye);
    #endif
        
    #if NLIGHTS > 0
        for (int i=0;i<NLIGHTS;i++) {
          colDiff = vec4(vCol.rgb * diffuse[i], vCol.a);
          lightdir = lightDir[i];
          if (!viewpoint[i])
            lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;
          if (!finite[i]) {
            halfVec = normalize(lightdir + eye);
          } else {
            lightdir = normalize(lightdir - vPosition.xyz/vPosition.w);
            halfVec = normalize(lightdir + eye);
          }
          col = ambient[i];
          nDotL = dot(n, lightdir);
          col = col + max(nDotL, 0.) * colDiff.rgb;
          col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular[i];
          lighteffect = lighteffect + vec4(col, colDiff.a);
        }
    #endif
        
    #else // not IS_LIT
        vec4 colDiff = vCol;
        vec4 lighteffect = colDiff;
    #endif
        
    #ifdef IS_TEXT
        vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);
    #endif
        
    #ifdef HAS_TEXTURE
    #ifdef TEXTURE_rgb
        vec4 textureColor = lighteffect*vec4(texture2D(uSampler, vTexcoord).rgb, 1.);
    #endif
        
    #ifdef TEXTURE_rgba
        vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);
    #endif
        
    #ifdef TEXTURE_alpha
        vec4 textureColor = texture2D(uSampler, vTexcoord);
        float luminance = dot(vec3(1.,1.,1.), textureColor.rgb)/3.;
        textureColor =  vec4(lighteffect.rgb, lighteffect.a*luminance);
    #endif
        
    #ifdef TEXTURE_luminance
        vec4 textureColor = vec4(lighteffect.rgb*dot(texture2D(uSampler, vTexcoord).rgb, vec3(1.,1.,1.))/3., lighteffect.a);
    #endif
        
    #ifdef TEXTURE_luminance_alpha
        vec4 textureColor = texture2D(uSampler, vTexcoord);
        float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;
        textureColor = vec4(lighteffect.rgb*luminance, lighteffect.a*textureColor.a);
    #endif
        
        fragColor = textureColor;

    #elif defined(IS_TEXT)
        if (textureColor.a < 0.1)
          discard;
        else
          fragColor = textureColor;
    #else
        fragColor = lighteffect;
    #endif // HAS_TEXTURE
        
    #ifdef HAS_FOG
        // uFogParms elements: x = near, y = far, z = fogscale, w = (1-sin(FOV/2))/(1+sin(FOV/2))
        // In Exp and Exp2: use density = density/far
        // fogF will be the proportion of fog
        // Initialize it to the linear value
        float fogF;
        if (uFogMode > 0) {
          fogF = (uFogParms.y - vPosition.z/vPosition.w)/(uFogParms.y - uFogParms.x);
          if (uFogMode > 1)
            fogF = mix(uFogParms.w, 1.0, fogF);
          fogF = fogF*uFogParms.z;
          if (uFogMode == 2)
            fogF = 1.0 - exp(-fogF);
          // Docs are wrong: use (density*c)^2, not density*c^2
          // https://gitlab.freedesktop.org/mesa/mesa/-/blob/master/src/mesa/swrast/s_fog.c#L58
          else if (uFogMode == 3)
            fogF = 1.0 - exp(-fogF*fogF);
          fogF = clamp(fogF, 0.0, 1.0);
          gl_FragColor = vec4(mix(fragColor.rgb, uFogColor, fogF), fragColor.a);
        } else gl_FragColor = fragColor;
    #else
        gl_FragColor = fragColor;
    #endif // HAS_FOG
        
    }
    </script><!--/html_preserve--><script src="libs/CanvasMatrix4-0.110.3/CanvasMatrix.src.js"></script><script src="libs/globe-binding-0.3.3/globe.js"></script><script src="libs/d3-tip-0.8.1/index.js"></script><link href="libs/chorddiag-0.1.2.9000/chorddiag.css" rel="stylesheet">
<script src="libs/chorddiag-0.1.2.9000/chorddiag.js"></script><link href="libs/collapsibleTree-0.1.6/collapsibleTree.css" rel="stylesheet">
<script src="libs/collapsibleTree-binding-0.1.7/collapsibleTree.js"></script><link href="libs/circlepackeR-0.1/./style.css" rel="stylesheet">
<script src="libs/circlepackeR-binding-0.0.0.9000/circlepackeR.js"></script><link href="libs/colorbrewer-1/colorbrewer.css" rel="stylesheet">
<script src="libs/colorbrewer-1/colorbrewer.js"></script><link href="libs/streamgraph-1/streamgraph.css" rel="stylesheet">
<script src="libs/streamgraph-binding-0.9.0/streamgraph.js"></script><link href="libs/visjs-7.4.9/vis-timeline-graph2d.min.css" rel="stylesheet">
<script src="libs/visjs-7.4.9/vis-timeline-graph2d.min.js"></script><link href="libs/timeline-0.4/timevis.css" rel="stylesheet">
<script src="libs/timevis-binding-2.1.0/timevis.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/Dygraph.Plugins.Crosshair-1.0/crosshair.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Community Contributions for EDAV Fall 2022 Tues/Thurs</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="community-contribution.html"><span class="header-section-number">2</span> Community Contribution</a></li>
<li><a class="" href="github-submission-instructions.html"><span class="header-section-number">3</span> GitHub submission instructions</a></li>
<li><a class="" href="sample-project.html"><span class="header-section-number">4</span> Sample project</a></li>
<li class="book-part">Cheatsheets</li>
<li><a class="" href="r-window-functions-cheatsheet.html"><span class="header-section-number">6</span> R window functions cheatsheet</a></li>
<li><a class="" href="rmd-chunk-option-cheat-sheet.html"><span class="header-section-number">7</span> Rmd chunk option cheat sheet</a></li>
<li><a class="" href="helpful-ggplot2-extensions-cheatsheet.html"><span class="header-section-number">8</span> Helpful ggplot2 Extensions Cheatsheet</a></li>
<li><a class="" href="commonly-used-graph-cheatcheet.html"><span class="header-section-number">9</span> Commonly-used graph cheatcheet</a></li>
<li><a class="" href="git-and-version-control.html"><span class="header-section-number">10</span> Git and version control</a></li>
<li><a class="" href="useful-plots-for-bioinfomatics-in-r.html"><span class="header-section-number">11</span> Useful plots for Bioinfomatics in R</a></li>
<li><a class="" href="different-ways-to-create-world-map-in-r.html"><span class="header-section-number">12</span> Different ways to create world map in R</a></li>
<li><a class="" href="color-in-r-python-and-jshtmlcss.html"><span class="header-section-number">13</span> Color in R, Python, and JS/HTML/CSS</a></li>
<li><a class="" href="color-palettes-for-data-visualization.html"><span class="header-section-number">14</span> Color Palettes for Data Visualization</a></li>
<li><a class="" href="data-visualization-using-seaborn.html"><span class="header-section-number">15</span> Data visualization using Seaborn</a></li>
<li><a class="" href="machine-learning-cheatsheet-for-r-and-python.html"><span class="header-section-number">16</span> Machine Learning Cheatsheet for R and Python</a></li>
<li><a class="" href="data-visualization-with-r-ggplot2-vs.-matlab.html"><span class="header-section-number">17</span> Data Visualization with R ggplot2 vs. Matlab</a></li>
<li><a class="" href="ggplot2-plots-in-python-cheat-sheet-tutorial.html"><span class="header-section-number">18</span> Ggplot2 plots in python cheat sheet tutorial</a></li>
<li><a class="" href="model-evaluation-selection-visualization-with-easystats.html"><span class="header-section-number">19</span> Model evaluation, selection &amp; visualization with easystats</a></li>
<li><a class="" href="time-series-itsmr-cheat-sheet.html"><span class="header-section-number">20</span> Time Series: ITSMR Cheat Sheet</a></li>
<li class="book-part">Tutorials</li>
<li><a class="" href="preprocessing-and-visualization-of-time-series-data.html"><span class="header-section-number">22</span> Preprocessing and Visualization of Time Series Data</a></li>
<li><a class="" href="how-to-use-sqldf.html"><span class="header-section-number">23</span> How to use sqldf</a></li>
<li><a class="" href="googlevis-in-r.html"><span class="header-section-number">24</span> googleVis in R</a></li>
<li><a class="" href="tutorial-for-vector-fields-in-r.html"><span class="header-section-number">25</span> Tutorial for vector fields in r</a></li>
<li><a class="" href="a-summary-of-interactive-chart.html"><span class="header-section-number">26</span> A Summary of Interactive Chart</a></li>
<li><a class="" href="data-cleaning-with-r.html"><span class="header-section-number">27</span> Data cleaning with r</a></li>
<li><a class="" href="introduction-to-shiny-web-apps.html"><span class="header-section-number">28</span> Introduction to Shiny Web Apps</a></li>
<li><a class="" href="python-missingno-library-tutorial.html"><span class="header-section-number">29</span> Python missingno library tutorial</a></li>
<li><a class="" href="data-explorer-tutorial-and-automation.html"><span class="header-section-number">30</span> Data Explorer Tutorial and Automation</a></li>
<li><a class="" href="d-visualization-in-r.html"><span class="header-section-number">31</span> 3D Visualization in R</a></li>
<li><a class="" href="visualizing-time-series-data.html"><span class="header-section-number">32</span> Visualizing Time Series Data</a></li>
<li><a class="" href="igraph-in-r.html"><span class="header-section-number">33</span> igraph in r</a></li>
<li><a class="" href="geo-mapping-coordinate-extraction-using-api-calls.html"><span class="header-section-number">34</span> Geo-Mapping Coordinate Extraction Using API Calls</a></li>
<li><a class="" href="edav-garden.html"><span class="header-section-number">35</span> EDAV Garden</a></li>
<li><a class="" href="using-raster-data-in-r.html"><span class="header-section-number">36</span> Using raster data in R</a></li>
<li><a class="" href="make-geographical-maps-with-different-packages.html"><span class="header-section-number">37</span> Make Geographical Maps with Different Packages</a></li>
<li><a class="" href="how-to-obtain-data-from-api-and-process-raw-json-data.html"><span class="header-section-number">38</span> How to obtain data from API and process raw JSON data</a></li>
<li><a class="" href="sample-statistic-tutorial.html"><span class="header-section-number">39</span> Sample Statistic Tutorial</a></li>
<li><a class="" href="data-cleaning-tutorial.html"><span class="header-section-number">40</span> Data cleaning tutorial</a></li>
<li><a class="" href="mlr3-package-tutorial.html"><span class="header-section-number">41</span> mlr3 Package Tutorial</a></li>
<li><a class="" href="guide-to-nonparametric-tests.html"><span class="header-section-number">42</span> Guide to nonparametric tests</a></li>
<li><a class="" href="dplyr-pacakage-in-r.html"><span class="header-section-number">43</span> dplyr pacakage in R</a></li>
<li><a class="" href="how-not-to-visualize-american-elections.html"><span class="header-section-number">44</span> How (not) to visualize American elections</a></li>
<li><a class="" href="time-series-visualization-with-r.html"><span class="header-section-number">45</span> Time series visualization with R</a></li>
<li><a class="" href="twitter-textual-data-scraping-and-analyzing.html"><span class="header-section-number">46</span> Twitter textual data: scraping and analyzing</a></li>
<li><a class="" href="causal-inference-tutorial-a-quick-glance-at-interventional-treatment-and-simpsons-paradox.html"><span class="header-section-number">47</span> Causal Inference Tutorial: A Quick Glance at Interventional Treatment and Simpson’s Paradox</a></li>
<li><a class="" href="network-analysis-and-social-network-analysis.html"><span class="header-section-number">48</span> Network analysis and social network analysis</a></li>
<li><a class="" href="network-analysis-in-r.html"><span class="header-section-number">49</span> Network Analysis in R</a></li>
<li><a class="" href="interactive-3d-visualization-in-r.html"><span class="header-section-number">50</span> Interactive 3D Visualization in R</a></li>
<li><a class="active" href="introduction-to-common-sampling-techniques-in-r.html"><span class="header-section-number">51</span> Introduction to common sampling techniques in r</a></li>
<li><a class="" href="machine-learning-in-r.html"><span class="header-section-number">52</span> Machine Learning in R</a></li>
<li><a class="" href="r-machine-learning-workflow-tutorial.html"><span class="header-section-number">53</span> R machine learning workflow tutorial</a></li>
<li><a class="" href="what-you-see-is-what-you-understand-learning-data-science-visually.html"><span class="header-section-number">54</span> What you see is what you understand: learning data science visually</a></li>
<li><a class="" href="is-the-data-visualization-misleading-or-not---survey.html"><span class="header-section-number">55</span> Is the data visualization misleading or not - Survey</a></li>
<li><a class="" href="animating-functions-and-histograms-in-python-using-matplotlib.html"><span class="header-section-number">56</span> Animating functions and histograms in python using matplotlib</a></li>
<li><a class="" href="waterfall-chart-using-meta-income-statement.html"><span class="header-section-number">57</span> Waterfall chart using meta income statement</a></li>
<li><a class="" href="plotnine-vs.-seaborn-in-python.html"><span class="header-section-number">58</span> Plotnine vs. Seaborn in python</a></li>
<li class="book-part">Interview Prep</li>
<li><a class="" href="ten-interview-questions-and-answers.html"><span class="header-section-number">60</span> Ten interview questions and answers</a></li>
<li><a class="" href="data-science-internship-search-survival-guide.html"><span class="header-section-number">61</span> Data science internship search survival guide</a></li>
<li><a class="" href="data-visualization-interview-questions-sample.html"><span class="header-section-number">62</span> Data visualization interview questions sample</a></li>
<li><a class="" href="how-i-got-into-amazon-as-a-full-time-data-analyst.html"><span class="header-section-number">63</span> How I got into Amazon as a full time data analyst</a></li>
<li class="book-part">Case Studies</li>
<li><a class="" href="benford-case-study.html"><span class="header-section-number">65</span> Benford Case Study</a></li>
<li class="book-part">Blogs</li>
<li><a class="" href="equity-in-ai.html"><span class="header-section-number">67</span> Equity in AI</a></li>
<li><a class="" href="breaking-into-tech-black-girl-edition.html"><span class="header-section-number">68</span> Breaking into tech: black girl edition</a></li>
<li><a class="" href="homepage-artwork.html"><span class="header-section-number">69</span> Homepage Artwork</a></li>
<li><a class="" href="design-homepage-for-class-community.html"><span class="header-section-number">70</span> Design homepage for class community</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="github-initial-setup.html"><span class="header-section-number">71</span> Github initial setup</a></li>
<li><a class="" href="tutorial-for-pull-request-mergers.html"><span class="header-section-number">72</span> Tutorial for pull request mergers</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jtr13/cc22tt">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="introduction-to-common-sampling-techniques-in-r" class="section level1" number="51">
<h1>
<span class="header-section-number">51</span> Introduction to common sampling techniques in r<a class="anchor" aria-label="anchor" href="#introduction-to-common-sampling-techniques-in-r"><i class="fas fa-link"></i></a>
</h1>
<p>Yuanyi Hu</p>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load packages:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/">survey</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://gdfe.co/srvyr/">srvyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">sampling</span><span class="op">)</span></span></code></pre></div>
<div id="motivation-12" class="section level3" number="51.0.1">
<h3>
<span class="header-section-number">51.0.1</span> Motivation<a class="anchor" aria-label="anchor" href="#motivation-12"><i class="fas fa-link"></i></a>
</h3>
<p>This semester, we have learned a lot of valuable techniques for analyzing the potential information behind large-scale data. Sometimes, the entire population data are not accessible due to the cost of data collection. It’s also quite efficient to analyze the key information by finding a proper sample to estimate the population. This tutorial introduces how to conduct common sampling methods in R and different scenarios to use them.</p>
</div>
<div id="simple-random-sampling" class="section level3" number="51.0.2">
<h3>
<span class="header-section-number">51.0.2</span> Simple random sampling<a class="anchor" aria-label="anchor" href="#simple-random-sampling"><i class="fas fa-link"></i></a>
</h3>
<p>Simple random sampling is one of the most popular and frequently used methods in research and social survey. In a simple random sampling, every element in the population has an equal probability of being selected. The package <code>survey</code> is very helpful to realize this method, and the package <code>srvyr</code> will calculate summary statistics on survey data. To illustrate this process, we will use the <code>api</code> dataset from <code>survey</code>. The <code>api</code> dataset records information about student performance in California schools based on the academic performance index (that’s why it’s named as <code>api</code>) computed from standardized testing and other relevant information about schools.</p>
<p>In this example, we will use a sample of <span class="math inline">\(600\)</span> schools, to estimate the total <code>api99</code> (academic performance index in 1999) in the entire population. In other words, this process will show the precision of using simple random sampling to select approximately <span class="math inline">\(10%\)</span> of population data to estimate the target information. As shown below, <code>apipop</code> has <span class="math inline">\(6194\)</span> rows and <span class="math inline">\(37\)</span> columns. Since we are focusing on <code>api99</code>, we should first check whether there are missing values (<code>NA</code>) in that column.</p>
<div class="sourceCode" id="cb778"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load data, we use the population data in it, apipop</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span>
<span><span class="co">#check number of rows and columns:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">apipop</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 6194   37</code></pre>
<div class="sourceCode" id="cb780"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#take a look at its situation of missing values in api99:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">apipop</span><span class="op">$</span><span class="va">api99</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Based on the above check, there is no <code>NA</code> in <code>api99</code>. We can first sum up all <code>api99</code> in the population data, and denoted as <code>total_api99</code>. <code>total_api99</code> is equal to <span class="math inline">\(3914069\)</span>. Then, we can use the function <code>sample</code> to select a sample of <span class="math inline">\(600\)</span> out of <span class="math inline">\(6194\)</span>. Since we want to use each element only once, we should set <code>replace=F</code>, but of course you can choose to make a SRS with replacement in other situations.</p>
<div class="sourceCode" id="cb782"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#real sum of all api99 in population data:</span></span>
<span><span class="va">apipop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_api99 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">api99</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   total_api99
## 1     3914069</code></pre>
<div class="sourceCode" id="cb784"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#if removed random seed, then we will get different results each time</span></span>
<span><span class="co">#here is just for reproducibility of results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#make a SRS with size of 600 without replacement</span></span>
<span><span class="va">api_sample</span> <span class="op">=</span> <span class="va">apipop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6194</span>,size<span class="op">=</span><span class="fl">600</span>, replace<span class="op">=</span><span class="cn">F</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">api_sample</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 600  37</code></pre>
<p>With the help of histograms, we can see that our sample reflects a similar distribution as the entire population. It’s reasonable to see the slight difference between them since the sample only contains around <span class="math inline">\(10\%\)</span> data.</p>
<div class="sourceCode" id="cb786"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">api_sample</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">api99</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"darkseagreen3"</span>,col<span class="op">=</span><span class="st">"black"</span>,bins <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="common_sampling_methods_in_r_tutorial_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb787"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">apipop</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">api99</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"darkseagreen3"</span>,col<span class="op">=</span><span class="st">"black"</span>, bins <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="common_sampling_methods_in_r_tutorial_files/figure-html/unnamed-chunk-5-2.png" width="80%" style="display: block; margin: auto;">
Then, we can summarize the sample mean, variance, standard deviation, estimated total, and the standard error of estimated total. Recall that sample mean is an unbiased estimator for the population mean. Hence, calculating the total <code>api99</code> in population by using the product of population size and sample mean is still unbiased because of the property of expectation, <span class="math inline">\(E[aX]=aE[X]\)</span>. Then, the standard error of this estimate can be calculated by <span class="math inline">\(N\sqrt{1-\frac{n}{N}}\frac{s}{\sqrt{n} }\)</span>, where <span class="math inline">\(N=6194\)</span> and <span class="math inline">\(n=600\)</span> in our case.</p>
<div class="sourceCode" id="cb788"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>sample_mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">api99</span><span class="op">)</span>,</span>
<span>sample_variance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">api99</span><span class="op">)</span>,</span>
<span>sample_std <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">api99</span><span class="op">)</span>,</span>
<span>estimated_total_api99 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">api99</span><span class="op">)</span><span class="op">*</span><span class="fl">6194</span>,</span>
<span>se_estimated_total <span class="op">=</span> <span class="fl">6194</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">600</span><span class="op">/</span><span class="fl">6194</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">api99</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">600</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   sample_mean sample_variance sample_std estimated_total_api99
## 1    632.6017         18159.5   134.7572               3918335
##   se_estimated_total
## 1           32383.45</code></pre>
<p>The estimated total <code>api99</code> is <span class="math inline">\(3918335\)</span>, which is relatively precise compared with the real value at <span class="math inline">\(3914069\)</span>. The other way to find the estimated total is using the functions <code>svydesign</code> and <code>svytotal</code> of the <code>survey</code> package, we can see that the results are same as above. Also, we can use <code>confint</code> to find a confidence interval for our estimate. By default, it will calculate the <span class="math inline">\(95\%\)</span> confidence interval, and in our example, the real total <code>api99</code>, <span class="math inline">\(3914069\)</span>, is in this interval.</p>
<div class="sourceCode" id="cb790"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_sample_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, data<span class="op">=</span><span class="va">api_sample</span>, fpc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">6194</span>,<span class="fl">600</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html">svytotal</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">~</span><span class="va">api99</span>,design<span class="op">=</span><span class="va">api_sample_d</span><span class="op">)</span></span></code></pre></div>
<pre><code>##         total    SE
## api99 3918335 32383</code></pre>
<div class="sourceCode" id="cb792"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">api99</span>,<span class="va">api_sample_d</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##         2.5 %  97.5 %
## api99 3854864 3981805</code></pre>
</div>
<div id="stratified-sampling" class="section level3" number="51.0.3">
<h3>
<span class="header-section-number">51.0.3</span> Stratified sampling<a class="anchor" aria-label="anchor" href="#stratified-sampling"><i class="fas fa-link"></i></a>
</h3>
<p>The other common sampling method is stratified sampling. We can use it when a population can be partitioned into subgroups, each subgroup having a distinct pattern. In our previous example, we can see that all schools can be classified into three levels:</p>
<div class="sourceCode" id="cb794"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">apipop</span><span class="op">$</span><span class="va">stype</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] H M E
## Levels: E H M</code></pre>
<p>These labels represent the high school, middle school, and elementary school. Hence, we can draw a proportional number of schools as the sample size for each level according to the size of each stratum in the entire population and then combine them as a whole sample. This sample has a similar data structure as the population data in terms of <code>stype</code> and <code>api99</code>. Then, we should first calculate the proportion for each level, and then find the matched size of stratum in sample, and then get a entire sample of <span class="math inline">\(600\)</span> schools.</p>
<div class="sourceCode" id="cb796"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#we can see that there is no NA in the stype</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">apipop</span><span class="op">$</span><span class="va">stype</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb798"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#calculate the proportion for each level</span></span>
<span><span class="op">(</span><span class="va">table</span> <span class="op">=</span> <span class="op">(</span><span class="va">apipop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">stype</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion<span class="op">=</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, </span>
<span>                  stratum_sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">proportion</span><span class="op">*</span><span class="fl">600</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   stype    n proportion stratum_sample_size
## 1     E 4421  0.7137552                 428
## 2     H  755  0.1218922                  73
## 3     M 1018  0.1643526                  99</code></pre>
<p>Before we apply this method, it’s important to reorder the data by grouping each level together.</p>
<div class="sourceCode" id="cb800"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#set the random seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">180</span><span class="op">)</span></span>
<span><span class="co">#reorder the population according to the labels:</span></span>
<span><span class="va">apipop_reorder</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">apipop</span>,<span class="va">table</span>,by<span class="op">=</span><span class="st">"stype"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">stype</span><span class="op">)</span></span></code></pre></div>
<p>Then, we can apply the stratified sampling without replacement by using <code>strata</code>.</p>
<div class="sourceCode" id="cb801"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#use the strata method from package sampling</span></span>
<span><span class="va">apipop_sample</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sampling/man/strata.html">strata</a></span><span class="op">(</span><span class="va">apipop_reorder</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stype"</span><span class="op">)</span>,size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">428</span>,<span class="fl">73</span>,<span class="fl">99</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"srswor"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">apipop_sample</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 600   4</code></pre>
<div class="sourceCode" id="cb803"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">apipop_sample</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "stype"   "ID_unit" "Prob"    "Stratum"</code></pre>
<p>We can see that there is a variable named <code>ID_unit</code>. This is the identifier of the selected units. We can slice the selected rows from the entire population.</p>
<div class="sourceCode" id="cb805"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">apipop_sample</span> <span class="op">&lt;-</span> <span class="va">apipop_reorder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">apipop_sample</span><span class="op">$</span><span class="va">ID_unit</span><span class="op">)</span></span></code></pre></div>
<p>After we have our sample, we can find the estimated total <code>api99</code> and the <span class="math inline">\(95\%\)</span> confidence interval by using <code>svydesign</code>, <code>svytotal</code>, and <code>confint</code>. We can see that the estimated total <code>api99</code> is <span class="math inline">\(3912987\)</span>. It’s precise compared with the real value at <span class="math inline">\(3914069\)</span>, and makes a closer estimate to real value compared with the previous result by using simple random sampling. Also, the standard error for this estimate is smaller than the previous. Hence, we can see that stratified sampling may be more helpful if we can divide the population into subgroups.</p>
<div class="sourceCode" id="cb806"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_sample_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="fl">1</span>,strata<span class="op">=</span><span class="op">~</span><span class="va">stype</span>,data<span class="op">=</span><span class="va">apipop_sample</span>,fpc<span class="op">=</span><span class="op">~</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">api99</span>,<span class="va">api_sample_d</span><span class="op">)</span></span></code></pre></div>
<pre><code>##         total    SE
## api99 3912987 31953</code></pre>
<div class="sourceCode" id="cb808"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">api99</span>,<span class="va">api_sample_d</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##         2.5 %  97.5 %
## api99 3850360 3975614</code></pre>
</div>
<div id="source" class="section level3" number="51.0.4">
<h3>
<span class="header-section-number">51.0.4</span> Source:<a class="anchor" aria-label="anchor" href="#source"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://www.rdocumentation.org/packages/survey/versions/4.1-1" class="uri">https://www.rdocumentation.org/packages/survey/versions/4.1-1</a></p>
<p><a href="https://r-survey.r-forge.r-project.org/survey/html/api.html" class="uri">https://r-survey.r-forge.r-project.org/survey/html/api.html</a></p>
<p><a href="https://cran.r-project.org/web/packages/srvyr/srvyr.pdf" class="uri">https://cran.r-project.org/web/packages/srvyr/srvyr.pdf</a></p>
<p><a href="https://online.stat.psu.edu/stat506/book/export/html/630" class="uri">https://online.stat.psu.edu/stat506/book/export/html/630</a></p>
<p><a href="https://en.wikipedia.org/wiki/Stratified_sampling" class="uri">https://en.wikipedia.org/wiki/Stratified_sampling</a></p>
<p><a href="https://www.rdocumentation.org/packages/sampling/versions/2.9/topics/strata" class="uri">https://www.rdocumentation.org/packages/sampling/versions/2.9/topics/strata</a></p>
<p><a href="https://zacharylhertz.github.io/posts/2021/06/survey-package" class="uri">https://zacharylhertz.github.io/posts/2021/06/survey-package</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="interactive-3d-visualization-in-r.html"><span class="header-section-number">50</span> Interactive 3D Visualization in R</a></div>
<div class="next"><a href="machine-learning-in-r.html"><span class="header-section-number">52</span> Machine Learning in R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav"><li>
<a class="nav-link" href="#introduction-to-common-sampling-techniques-in-r"><span class="header-section-number">51</span> Introduction to common sampling techniques in r</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#motivation-12"><span class="header-section-number">51.0.1</span> Motivation</a></li>
<li><a class="nav-link" href="#simple-random-sampling"><span class="header-section-number">51.0.2</span> Simple random sampling</a></li>
<li><a class="nav-link" href="#stratified-sampling"><span class="header-section-number">51.0.3</span> Stratified sampling</a></li>
<li><a class="nav-link" href="#source"><span class="header-section-number">51.0.4</span> Source:</a></li>
</ul>
</li></ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jtr13/cc22tt/blob/main/common_sampling_methods_in_r_tutorial.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jtr13/cc22tt/edit/main/common_sampling_methods_in_r_tutorial.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Community Contributions for EDAV Fall 2022 Tues/Thurs</strong>" was written by . It was last built on 2022-12-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
