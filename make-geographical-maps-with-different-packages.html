<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 34 Make Geographical Maps with Different Packages | Community Contributions for EDAV Fall 2022 Tues/Thurs</title>
<meta name="description" content="Xindi Deng library(readr) library(ggplot2) library(sf) library(osmextract)  34.1 Introduction When we do spacial analysis, we always focus on the map of USA and extract the dataset from maps...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 34 Make Geographical Maps with Different Packages | Community Contributions for EDAV Fall 2022 Tues/Thurs">
<meta property="og:type" content="book">
<meta property="og:description" content="Xindi Deng library(readr) library(ggplot2) library(sf) library(osmextract)  34.1 Introduction When we do spacial analysis, we always focus on the map of USA and extract the dataset from maps...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 34 Make Geographical Maps with Different Packages | Community Contributions for EDAV Fall 2022 Tues/Thurs">
<meta name="twitter:description" content="Xindi Deng library(readr) library(ggplot2) library(sf) library(osmextract)  34.1 Introduction When we do spacial analysis, we always focus on the map of USA and extract the dataset from maps...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/visjs-7.4.9/vis-timeline-graph2d.min.css" rel="stylesheet">
<script src="libs/visjs-7.4.9/vis-timeline-graph2d.min.js"></script><link href="libs/timeline-0.4/timevis.css" rel="stylesheet">
<script src="libs/timevis-binding-2.1.0/timevis.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Community Contributions for EDAV Fall 2022 Tues/Thurs</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="community-contribution.html"><span class="header-section-number">2</span> Community Contribution</a></li>
<li><a class="" href="github-submission-instructions.html"><span class="header-section-number">3</span> GitHub submission instructions</a></li>
<li><a class="" href="sample-project.html"><span class="header-section-number">4</span> Sample project</a></li>
<li class="book-part">Cheatsheets</li>
<li><a class="" href="r-window-functions-cheatsheet.html"><span class="header-section-number">6</span> R window functions cheatsheet</a></li>
<li><a class="" href="rmd-chunk-option-cheat-sheet.html"><span class="header-section-number">7</span> Rmd chunk option cheat sheet</a></li>
<li><a class="" href="helpful-ggplot2-extensions-cheatsheet.html"><span class="header-section-number">8</span> Helpful ggplot2 Extensions Cheatsheet</a></li>
<li><a class="" href="commonly-used-graph-cheatcheet.html"><span class="header-section-number">9</span> Commonly-used graph cheatcheet</a></li>
<li><a class="" href="git-and-version-control.html"><span class="header-section-number">10</span> Git and version control</a></li>
<li><a class="" href="useful-plots-for-bioinfomatics-in-r.html"><span class="header-section-number">11</span> Useful plots for Bioinfomatics in R</a></li>
<li><a class="" href="different-ways-to-create-world-map-in-r.html"><span class="header-section-number">12</span> Different ways to create world map in R</a></li>
<li><a class="" href="color-in-r-python-and-jshtmlcss.html"><span class="header-section-number">13</span> Color in R, Python, and JS/HTML/CSS</a></li>
<li><a class="" href="color-palettes-for-data-visualization.html"><span class="header-section-number">14</span> Color Palettes for Data Visualization</a></li>
<li><a class="" href="data-visualization-using-seaborn.html"><span class="header-section-number">15</span> Data visualization using Seaborn</a></li>
<li><a class="" href="machine-learning-cheatsheet-for-r-and-python.html"><span class="header-section-number">16</span> Machine Learning Cheatsheet for R and Python</a></li>
<li><a class="" href="data-visualization-with-r-ggplot2-vs.-matlab.html"><span class="header-section-number">17</span> Data Visualization with R ggplot2 vs. Matlab</a></li>
<li><a class="" href="ggplot2-plots-in-python-cheat-sheet-tutorial.html"><span class="header-section-number">18</span> Ggplot2 plots in python cheat sheet tutorial</a></li>
<li class="book-part">Tutorials</li>
<li><a class="" href="preprocessing-and-visualization-of-time-series-data.html"><span class="header-section-number">20</span> Preprocessing and Visualization of Time Series Data</a></li>
<li><a class="" href="how-to-use-sqldf.html"><span class="header-section-number">21</span> How to use sqldf</a></li>
<li><a class="" href="googlevis-in-r.html"><span class="header-section-number">22</span> googleVis in R</a></li>
<li><a class="" href="tutorial-for-vector-fields-in-r.html"><span class="header-section-number">23</span> Tutorial for vector fields in r</a></li>
<li><a class="" href="data-cleaning-with-r.html"><span class="header-section-number">24</span> Data cleaning with r</a></li>
<li><a class="" href="introduction-to-shiny-web-apps.html"><span class="header-section-number">25</span> Introduction to Shiny Web Apps</a></li>
<li><a class="" href="python-missingno-library-tutorial.html"><span class="header-section-number">26</span> Python missingno library tutorial</a></li>
<li><a class="" href="data-explorer-tutorial-and-automation.html"><span class="header-section-number">27</span> Data Explorer Tutorial and Automation</a></li>
<li><a class="" href="d-visualization-in-r.html"><span class="header-section-number">28</span> 3D Visualization in R</a></li>
<li><a class="" href="visualizing-time-series-data.html"><span class="header-section-number">29</span> Visualizing Time Series Data</a></li>
<li><a class="" href="igraph-in-r.html"><span class="header-section-number">30</span> igraph in r</a></li>
<li><a class="" href="geo-mapping-coordinate-extraction-using-api-calls.html"><span class="header-section-number">31</span> Geo-Mapping Coordinate Extraction Using API Calls</a></li>
<li><a class="" href="edav-garden.html"><span class="header-section-number">32</span> EDAV Garden</a></li>
<li><a class="" href="using-raster-data-in-r.html"><span class="header-section-number">33</span> Using raster data in R</a></li>
<li><a class="active" href="make-geographical-maps-with-different-packages.html"><span class="header-section-number">34</span> Make Geographical Maps with Different Packages</a></li>
<li class="book-part">Interview Prep</li>
<li><a class="" href="ten-interview-questions-and-answers.html"><span class="header-section-number">36</span> Ten interview questions and answers</a></li>
<li><a class="" href="data-science-internship-search-survival-guide.html"><span class="header-section-number">37</span> Data science internship search survival guide</a></li>
<li class="book-part">Case Studies</li>
<li><a class="" href="benford-case-study.html"><span class="header-section-number">39</span> Benford Case Study</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="github-initial-setup.html"><span class="header-section-number">40</span> Github initial setup</a></li>
<li><a class="" href="tutorial-for-pull-request-mergers.html"><span class="header-section-number">41</span> Tutorial for pull request mergers</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jtr13/cc22tt">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="make-geographical-maps-with-different-packages" class="section level1" number="34">
<h1>
<span class="header-section-number">34</span> Make Geographical Maps with Different Packages<a class="anchor" aria-label="anchor" href="#make-geographical-maps-with-different-packages"><i class="fas fa-link"></i></a>
</h1>
<p>Xindi Deng</p>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmextract/">osmextract</a></span><span class="op">)</span></span></code></pre></div>
<div id="introduction-2" class="section level2" number="34.1">
<h2>
<span class="header-section-number">34.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"><i class="fas fa-link"></i></a>
</h2>
<p>When we do spacial analysis, we always focus on the map of USA and extract the dataset from maps package in R. However, the number of datasets in maps package is limited and it does not contain the information of sub-regions for many other countries, such as China, Japan and so on.</p>
<p>In this tutorial, I first introduce a common way to plot a map by extracting coordinates from “maps” package, then I will talk about “osmextract” package which contains more information of geographical maps.</p>
</div>
<div id="make-geographical-maps-with-map-package" class="section level2" number="34.2">
<h2>
<span class="header-section-number">34.2</span> Make geographical maps with “map” package<a class="anchor" aria-label="anchor" href="#make-geographical-maps-with-map-package"><i class="fas fa-link"></i></a>
</h2>
<p>To make a geographical map, we first need to know the coordinates of all region boundaries for the target country. Here I introduce two ways to extract the data. The first one is more user-friendly while the second one contains more data sets.</p>
<div id="import-dataset-with-function-map_data" class="section level3" number="34.2.1">
<h3>
<span class="header-section-number">34.2.1</span> Import dataset with function “map_data”<a class="anchor" aria-label="anchor" href="#import-dataset-with-function-map_data"><i class="fas fa-link"></i></a>
</h3>
<p>One of the most common and user-friendly functions to extract map data from maps package is “map_data”. It can turn data from the maps package into a data frame suitable for plotting with ggplot2.</p>
<div id="usage-of-map_data" class="section level4" number="34.2.1.1">
<h4>
<span class="header-section-number">34.2.1.1</span> Usage of “map_data”<a class="anchor" aria-label="anchor" href="#usage-of-map_data"><i class="fas fa-link"></i></a>
</h4>
<p>map_data(map, region = “.”, exact = FALSE, …)</p>
<ul>
<li>
<p>map: the name of map provided by the maps package.</p>
<pre><code> The choices of map include a world map, three USA databases (usa, state, county), and more (including Italy database, France database, New Zealand database and so on). 
 We can use help(package='maps') to check what map data sets can be used by "map_data".</code></pre>
</li>
<li><p>region: select sub-regions in the map. Default is “.”.</p></li>
</ul>
</div>
<div id="dataset-exploration" class="section level4" number="34.2.1.2">
<h4>
<span class="header-section-number">34.2.1.2</span> Dataset exploration<a class="anchor" aria-label="anchor" href="#dataset-exploration"><i class="fas fa-link"></i></a>
</h4>
<p>Here we use map=“state” as an example to see the format of function return</p>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">statesMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">statesMap</span><span class="op">)</span></span></code></pre></div>
<pre><code>##        long      lat group order  region subregion
## 1 -87.46201 30.38968     1     1 alabama      &lt;NA&gt;
## 2 -87.48493 30.37249     1     2 alabama      &lt;NA&gt;
## 3 -87.52503 30.37249     1     3 alabama      &lt;NA&gt;
## 4 -87.53076 30.33239     1     4 alabama      &lt;NA&gt;
## 5 -87.57087 30.32665     1     5 alabama      &lt;NA&gt;
## 6 -87.58806 30.32665     1     6 alabama      &lt;NA&gt;</code></pre>
<p>The data set of “states” has 15537 coordinates and 6 features.
- long: the longitude of a coordinate on the boundaries
- lat: the latitude of a coordinate on the boundaries
- group: each minimum closed region has a unique group number
- region: the name of a region</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">statesMap</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "alabama"              "arizona"              "arkansas"            
##  [4] "california"           "colorado"             "connecticut"         
##  [7] "delaware"             "district of columbia" "florida"             
## [10] "georgia"              "idaho"                "illinois"            
## [13] "indiana"              "iowa"                 "kansas"              
## [16] "kentucky"             "louisiana"            "maine"               
## [19] "maryland"             "massachusetts"        "michigan"            
## [22] "minnesota"            "mississippi"          "missouri"            
## [25] "montana"              "nebraska"             "nevada"              
## [28] "new hampshire"        "new jersey"           "new mexico"          
## [31] "new york"             "north carolina"       "north dakota"        
## [34] "ohio"                 "oklahoma"             "oregon"              
## [37] "pennsylvania"         "rhode island"         "south carolina"      
## [40] "south dakota"         "tennessee"            "texas"               
## [43] "utah"                 "vermont"              "virginia"            
## [46] "washington"           "west virginia"        "wisconsin"           
## [49] "wyoming"</code></pre>
</div>
</div>
<div id="plot-maps" class="section level3" number="34.2.2">
<h3>
<span class="header-section-number">34.2.2</span> Plot maps<a class="anchor" aria-label="anchor" href="#plot-maps"><i class="fas fa-link"></i></a>
</h3>
<div id="the-logic-of-ploting-maps" class="section level4" number="34.2.2.1">
<h4>
<span class="header-section-number">34.2.2.1</span> The logic of ploting maps<a class="anchor" aria-label="anchor" href="#the-logic-of-ploting-maps"><i class="fas fa-link"></i></a>
</h4>
<p>To plot maps, we take each minimum closed region as a polygon. Since we know the coordinates on boundaries for each minimum closed region, we can plot each polygon by taking longitude as x-axis and taking latitude as y-axis. Since each minimum closed region has a unique group number, we can group the coordinates by the group number and plot all polygons on one graph.</p>
</div>
<div id="plot-the-map" class="section level4" number="34.2.2.2">
<h4>
<span class="header-section-number">34.2.2.2</span> Plot the map<a class="anchor" aria-label="anchor" href="#plot-the-map"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">statesMap</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">long</span>,y<span class="op">=</span><span class="va">lat</span>,group<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"white"</span>,color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="make_geographical_maps_with_different_packages_files/figure-html/unnamed-chunk-4-1.png" width="80%" style="display: block; margin: auto;">
#### Plot sub-regions of a map</div>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NewYorkMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">statesMap</span>, <span class="va">region</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"new jersey"</span>, <span class="st">"new york"</span>,<span class="st">"connecticut"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">NewYorkMap</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">long</span>,y<span class="op">=</span><span class="va">lat</span>, group<span class="op">=</span><span class="va">group</span>, fill <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="make_geographical_maps_with_different_packages_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="data-visualization-on-the-map" class="section level4" number="34.2.2.3">
<h4>
<span class="header-section-number">34.2.2.3</span> Data visualization on the map<a class="anchor" aria-label="anchor" href="#data-visualization-on-the-map"><i class="fas fa-link"></i></a>
</h4>
<p>Step 1: prepare the data frame.</p>
<p>Import the dataset that need to be visualized as a data frame. Combine the new data frame with the data frame of map by region names. Then we can get the data frame suitable for plotting.</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">murders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"./resources/make_geographical_maps_with_different_packages/murders.csv"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">murders</span><span class="op">$</span><span class="va">region</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">murders</span><span class="op">$</span><span class="va">State</span><span class="op">)</span></span>
<span><span class="va">murderMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">statesMap</span>,<span class="va">murders</span>,by<span class="op">=</span><span class="st">"region"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">murderMap</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    region      long      lat group order subregion   State Population
## 1 alabama -87.46201 30.38968     1     1      &lt;NA&gt; Alabama    4779736
## 2 alabama -87.48493 30.37249     1     2      &lt;NA&gt; Alabama    4779736
## 3 alabama -87.52503 30.37249     1     3      &lt;NA&gt; Alabama    4779736
## 4 alabama -87.53076 30.33239     1     4      &lt;NA&gt; Alabama    4779736
## 5 alabama -87.57087 30.32665     1     5      &lt;NA&gt; Alabama    4779736
## 6 alabama -87.58806 30.32665     1     6      &lt;NA&gt; Alabama    4779736
##   PopulationDensity Murders GunMurders GunOwnership
## 1             94.65     199        135        0.517
## 2             94.65     199        135        0.517
## 3             94.65     199        135        0.517
## 4             94.65     199        135        0.517
## 5             94.65     199        135        0.517
## 6             94.65     199        135        0.517</code></pre>
<p>Step 2: plot the visualization result</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">murderMap</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">long</span>, y<span class="op">=</span><span class="va">lat</span>, group<span class="op">=</span><span class="va">group</span>,fill<span class="op">=</span><span class="va">GunMurders</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"white"</span>,high<span class="op">=</span><span class="st">"red"</span>,guide<span class="op">=</span><span class="st">"legend"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="make_geographical_maps_with_different_packages_files/figure-html/unnamed-chunk-7-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
</div>
</div>
<div id="make-geographical-maps-with-osmextract-package" class="section level2" number="34.3">
<h2>
<span class="header-section-number">34.3</span> Make geographical maps with “osmextract” package<a class="anchor" aria-label="anchor" href="#make-geographical-maps-with-osmextract-package"><i class="fas fa-link"></i></a>
</h2>
<p>Even though the defined function “map_data” is easy to use, maps package only contains the data of coordinates for a few countries. To extract the coordinates on boundaries for more countries, such as China, we can use “osmextract” package.</p>
<div id="import-dataset-with-object-openstreetmap_fr_zones" class="section level3" number="34.3.1">
<h3>
<span class="header-section-number">34.3.1</span> Import dataset with object “openstreetmap_fr_zones”<a class="anchor" aria-label="anchor" href="#import-dataset-with-object-openstreetmap_fr_zones"><i class="fas fa-link"></i></a>
</h3>
<p>“openstreetmap_fr_zones” is an sf object of geographical zones taken from download.openstreetmap.fr.</p>
<div id="define-a-function-to-extract-the-coordinations-data" class="section level4" number="34.3.1.1">
<h4>
<span class="header-section-number">34.3.1.1</span> Define a function to extract the coordinations data<a class="anchor" aria-label="anchor" href="#define-a-function-to-extract-the-coordinations-data"><i class="fas fa-link"></i></a>
</h4>
<p>I define a function called “extract_map_data”, which can turn data from openstreetmap_fr_zones into a data frame suitable for plotting with ggplot2.</p>
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmextract/">osmextract</a></span><span class="op">)</span> </span>
<span><span class="co">#&gt; OpenStreetMap® is open data, licensed under the Open Data Commons Open Database License (ODbL) by the OpenStreetMap Foundation (OSMF).</span></span>
<span><span class="co">#&gt; Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright.</span></span>
<span><span class="co">#&gt; Check the package website, https://docs.ropensci.org/osmextract/, for more details.</span></span>
<span></span>
<span><span class="va">extract_map_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">region_name</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># get polygons in the target region</span></span>
<span>  <span class="va">poly_region</span> <span class="op">&lt;-</span> <span class="va">openstreetmap_fr_zones</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">openstreetmap_fr_zones</span><span class="op">$</span><span class="va">parent</span><span class="op">)</span> <span class="op">==</span> <span class="va">region_name</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="co"># extract the coordinations and save the coordinations in a data.frame</span></span>
<span>  <span class="va">poly_region_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">poly_region</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># extract the region name</span></span>
<span>  <span class="va">my_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">poly_region</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">poly_region_coords</span><span class="op">$</span><span class="va">region_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">poly_region</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>, times <span class="op">=</span> <span class="va">my_times</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># make the format of data frame similar to that from map_data and make it suitable for plotting with ggplot2</span></span>
<span>  <span class="va">poly_region_coords</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">poly_region_coords</span><span class="op">$</span><span class="va">L1</span>,<span class="st">","</span>,<span class="va">poly_region_coords</span><span class="op">$</span><span class="va">L2</span>,<span class="st">","</span>,<span class="va">poly_region_coords</span><span class="op">$</span><span class="va">L3</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">poly_region_coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>,<span class="st">"lat"</span>,<span class="st">"group1"</span>,<span class="st">"group2"</span>,<span class="st">"group3"</span>, <span class="st">"region"</span>,<span class="st">"group"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># explore the data frame</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">poly_region_coords</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">return</span> <span class="op">&lt;-</span> <span class="va">poly_region_coords</span> </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="usage-of-extract_map_data" class="section level4" number="34.3.1.2">
<h4>
<span class="header-section-number">34.3.1.2</span> Usage of “extract_map_data”<a class="anchor" aria-label="anchor" href="#usage-of-extract_map_data"><i class="fas fa-link"></i></a>
</h4>
<p>extract_map_data(map)</p>
<ul>
<li>map: the name of the region. All available regions are shown below.</li>
</ul>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">openstreetmap_fr_zones</span><span class="op">$</span><span class="va">parent</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] NA                                 "africa"                          
##  [3] "spain"                            "asia"                            
##  [5] "china"                            "india"                           
##  [7] "indonesia"                        "japan"                           
##  [9] "central-america"                  "europe"                          
## [11] "austria"                          "belgium"                         
## [13] "czech_republic"                   "finland"                         
## [15] "france"                           "alsace"                          
## [17] "aquitaine"                        "auvergne"                        
## [19] "basse_normandie"                  "bourgogne"                       
## [21] "bretagne"                         "centre"                          
## [23] "champagne_ardenne"                "corse"                           
## [25] "franche_comte"                    "haute_normandie"                 
## [27] "ile_de_france"                    "languedoc_roussillon"            
## [29] "limousin"                         "lorraine"                        
## [31] "midi_pyrenees"                    "nord_pas_de_calais"              
## [33] "pays_de_la_loire"                 "picardie"                        
## [35] "poitou_charentes"                 "provence_alpes_cote_d_azur"      
## [37] "rhone_alpes"                      "germany"                         
## [39] "nordrhein_westfalen"              "italy"                           
## [41] "netherlands"                      "norway"                          
## [43] "poland"                           "portugal"                        
## [45] "seas"                             "slovakia"                        
## [47] "sweden"                           "switzerland"                     
## [49] "ukraine"                          "united_kingdom"                  
## [51] "england"                          "north-america"                   
## [53] "canada"                           "ontario"                         
## [55] "quebec"                           "us-west"                         
## [57] "california"                       "oceania"                         
## [59] "australia"                        "russia"                          
## [61] "central_federal_district"         "far_eastern_federal_district"    
## [63] "north_caucasian_federal_district" "northwestern_federal_district"   
## [65] "siberian_federal_district"        "southern_federal_district"       
## [67] "ural_federal_district"            "volga_federal_district"          
## [69] "south-america"                    "argentina"                       
## [71] "brazil"                           "central-west"                    
## [73] "north"                            "northeast"                       
## [75] "south"                            "southeast"</code></pre>
</div>
</div>
<div id="plot-the-map-of-china" class="section level3" number="34.3.2">
<h3>
<span class="header-section-number">34.3.2</span> Plot the map of China<a class="anchor" aria-label="anchor" href="#plot-the-map-of-china"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map2</span> <span class="op">=</span> <span class="fu">extract_map_data</span><span class="op">(</span><span class="st">"china"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      long    lat group1 group2 group3 region     group
## 1 114.900 32.950      1      1      1  anhui 1 , 1 , 1
## 2 114.930 32.915      1      1      1  anhui 1 , 1 , 1
## 3 115.000 32.920      1      1      1  anhui 1 , 1 , 1
## 4 115.000 32.905      1      1      1  anhui 1 , 1 , 1
## 5 115.015 32.890      1      1      1  anhui 1 , 1 , 1
## 6 115.120 32.885      1      1      1  anhui 1 , 1 , 1</code></pre>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">map2</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">long</span>,y<span class="op">=</span><span class="va">lat</span>,group<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"white"</span>,color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="make_geographical_maps_with_different_packages_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="plot-the-map-of-japan" class="section level3" number="34.3.3">
<h3>
<span class="header-section-number">34.3.3</span> Plot the map of Japan<a class="anchor" aria-label="anchor" href="#plot-the-map-of-japan"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map2</span> <span class="op">=</span> <span class="fu">extract_map_data</span><span class="op">(</span><span class="st">"japan"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      long    lat group1 group2 group3 region     group
## 1 135.430 35.510      1      1      1  chubu 1 , 1 , 1
## 2 135.450 35.495      1      1      1  chubu 1 , 1 , 1
## 3 135.440 35.485      1      1      1  chubu 1 , 1 , 1
## 4 135.445 35.450      1      1      1  chubu 1 , 1 , 1
## 5 135.460 35.435      1      1      1  chubu 1 , 1 , 1
## 6 135.470 35.435      1      1      1  chubu 1 , 1 , 1</code></pre>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">map2</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">long</span>,y<span class="op">=</span><span class="va">lat</span>,group<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"white"</span>,color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="make_geographical_maps_with_different_packages_files/figure-html/unnamed-chunk-11-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>References:</p>
<p><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="uri">https://ggplot2.tidyverse.org/reference/map_data.html</a></p>
<p><a href="https://cran.r-project.org/web/packages/osmextract/vignettes/osmextract.html" class="uri">https://cran.r-project.org/web/packages/osmextract/vignettes/osmextract.html</a></p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="using-raster-data-in-r.html"><span class="header-section-number">33</span> Using raster data in R</a></div>
<div class="next"><a href="ten-interview-questions-and-answers.html"><span class="header-section-number">36</span> Ten interview questions and answers</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#make-geographical-maps-with-different-packages"><span class="header-section-number">34</span> Make Geographical Maps with Different Packages</a></li>
<li><a class="nav-link" href="#introduction-2"><span class="header-section-number">34.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#make-geographical-maps-with-map-package"><span class="header-section-number">34.2</span> Make geographical maps with “map” package</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#import-dataset-with-function-map_data"><span class="header-section-number">34.2.1</span> Import dataset with function “map_data”</a></li>
<li><a class="nav-link" href="#plot-maps"><span class="header-section-number">34.2.2</span> Plot maps</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#make-geographical-maps-with-osmextract-package"><span class="header-section-number">34.3</span> Make geographical maps with “osmextract” package</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#import-dataset-with-object-openstreetmap_fr_zones"><span class="header-section-number">34.3.1</span> Import dataset with object “openstreetmap_fr_zones”</a></li>
<li><a class="nav-link" href="#plot-the-map-of-china"><span class="header-section-number">34.3.2</span> Plot the map of China</a></li>
<li><a class="nav-link" href="#plot-the-map-of-japan"><span class="header-section-number">34.3.3</span> Plot the map of Japan</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jtr13/cc22tt/blob/main/make_geographical_maps_with_different_packages.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jtr13/cc22tt/edit/main/make_geographical_maps_with_different_packages.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Community Contributions for EDAV Fall 2022 Tues/Thurs</strong>" was written by . It was last built on 2022-11-15.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
