<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 Benford Case Study | Community Contributions for EDAV Fall 2022 Tues/Thurs</title>
<meta name="description" content='Abhiram Gaddam, Devan Samant library(benford.analysis) #install.packages("benford.analysis") library(dplyr) library(plotly) library(tidyverse)  17.1 Contents In this tutorial, we will introduce a...'>
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 17 Benford Case Study | Community Contributions for EDAV Fall 2022 Tues/Thurs">
<meta property="og:type" content="book">
<meta property="og:description" content='Abhiram Gaddam, Devan Samant library(benford.analysis) #install.packages("benford.analysis") library(dplyr) library(plotly) library(tidyverse)  17.1 Contents In this tutorial, we will introduce a...'>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 17 Benford Case Study | Community Contributions for EDAV Fall 2022 Tues/Thurs">
<meta name="twitter:description" content='Abhiram Gaddam, Devan Samant library(benford.analysis) #install.packages("benford.analysis") library(dplyr) library(plotly) library(tidyverse)  17.1 Contents In this tutorial, we will introduce a...'>
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Community Contributions for EDAV Fall 2022 Tues/Thurs</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="community-contribution.html"><span class="header-section-number">2</span> Community Contribution</a></li>
<li><a class="" href="github-submission-instructions.html"><span class="header-section-number">3</span> GitHub submission instructions</a></li>
<li><a class="" href="sample-project.html"><span class="header-section-number">4</span> Sample project</a></li>
<li class="book-part">Cheatsheets</li>
<li><a class="" href="r-window-functions-cheatsheet.html"><span class="header-section-number">6</span> R window functions cheatsheet</a></li>
<li><a class="" href="rmd-chunk-option-cheat-sheet.html"><span class="header-section-number">7</span> Rmd chunk option cheat sheet</a></li>
<li><a class="" href="helpful-ggplot2-extensions-cheatsheet.html"><span class="header-section-number">8</span> Helpful ggplot2 Extensions Cheatsheet</a></li>
<li><a class="" href="commonly-used-graph-cheatcheet.html"><span class="header-section-number">9</span> Commonly-used graph cheatcheet</a></li>
<li class="book-part">Tutorials</li>
<li><a class="" href="preprocessing-and-visualization-of-time-series-data.html"><span class="header-section-number">11</span> Preprocessing and Visualization of Time Series Data</a></li>
<li><a class="" href="how-to-use-sqldf.html"><span class="header-section-number">12</span> How to use sqldf</a></li>
<li><a class="" href="googlevis-in-r.html"><span class="header-section-number">13</span> googleVis in R</a></li>
<li class="book-part">Interview Prep</li>
<li><a class="" href="ten-interview-questions-and-answers.html"><span class="header-section-number">15</span> Ten interview questions and answers</a></li>
<li class="book-part">Case Studies</li>
<li><a class="active" href="benford-case-study.html"><span class="header-section-number">17</span> Benford Case Study</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="github-initial-setup.html"><span class="header-section-number">18</span> Github initial setup</a></li>
<li><a class="" href="tutorial-for-pull-request-mergers.html"><span class="header-section-number">19</span> Tutorial for pull request mergers</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jtr13/cc22tt">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="benford-case-study" class="section level1">
<h1>
<span class="header-section-number">17</span> Benford Case Study<a class="anchor" aria-label="anchor" href="#benford-case-study"><i class="fas fa-link"></i></a>
</h1>
<p>Abhiram Gaddam, Devan Samant</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/carloscinelli/benford.analysis">benford.analysis</a></span><span class="op">)</span>  <span class="co">#install.packages("benford.analysis")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<div id="contents" class="section level2">
<h2>
<span class="header-section-number">17.1</span> Contents<a class="anchor" aria-label="anchor" href="#contents"><i class="fas fa-link"></i></a>
</h2>
<p>In this tutorial, we will introduce a numeric property called Benford’s Law and illustrate its applications in fraud detection. We will be using the benford_analysis package in R along with an example case study.</p>
<p>Sections:</p>
<ol style="list-style-type: decimal">
<li>Introduction</li>
<li>Benford.Analysis Package</li>
<li>Randomized Data Case Study</li>
<li>Conclusion</li>
<li>Sources</li>
</ol>
</div>
<div id="introduction" class="section level2">
<h2>
<span class="header-section-number">17.2</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h2>
<p>There is a niche area of the consulting industry called forensic analytics in which analysts try to identify risks and quantify wrongdoing using an array of statistical and data techniques. For example, imagine a whistleblower notifies a company’s general counsel that there has been some collusion between sales and finance representatives to artificially create invoices. The company may hire forensic analysts to extract and determine what is happening. There are many quantitative and qualitative methods to perform before concluding anything and they will need to be specific to the context of the project. One such heuristic is Benford’s Law.</p>
<div id="what-is-benfords-law" class="section level3">
<h3>
<span class="header-section-number">17.2.1</span> What is Benford’s Law?<a class="anchor" aria-label="anchor" href="#what-is-benfords-law"><i class="fas fa-link"></i></a>
</h3>
<p>Benford’s law (also known as the first digit law) states that the leading digits in many data sets are probably going to be small. For example, most numbers in a set (about 30%) will have a leading digit of 1, when one might expect the probability to be 11.1% (one out of nine digits). After one, the second most common leading digit is 2 at about 17.5%. And so forth for 3 and onward. To put it simply, Benford’s law is a probability distribution for the likelihood of the first digit in a set of numbers (Frunza, 2015). This pattern is not an intuitive phenomenon but holds true for many naturally occurring datasets (ex. height of mountains around the world) as well as man-made ones such as a company’s general ledger.</p>
<p>The formula for Benford’s Law is:
<span class="math inline">\(P(d) = \frac{ln(1 + \frac{1}{d})}{ln10}\)</span>
where <span class="math inline">\(d\)</span> is the leading digit (a number from 1 to 9)</p>
<p>Below is a distribution that shows the expected occurrence of leading digits according to Benford’s Law.</p>
<div class="figure">
<img src="resources/benford_case_study/b1.jpeg" alt=""><p class="caption">Benfords Law Distribution.</p>
</div>
<p>However, there are a few caveats regarding the application of Benford’s Law:</p>
<ol style="list-style-type: decimal">
<li><p>Benford’s Law works better with larger sets of data. While the law has been shown to hold true for data sets containing as few as 50 to 100 numbers, most experts believe data sets of 500 or more numbers are better suited for this type of analysis.
(<a href="https://tinyurl.com/2p97fsvn" class="uri">https://tinyurl.com/2p97fsvn</a>)</p></li>
<li><p>To conform with the law, the data set you use must contain data in which each number 1 through 9 has an equal chance of occurring as the leading digit. Otherwise, Benford’s Law doesn’t apply. For example, consider a listing of the heights of current NBA players. Since NBA players range in height from 5 feet 10 inches to 7 feet 3 inches, there are no player heights that begin with a 1, 2, 3, 4, 8, or 9; Clearly those digits have no chance of being the first digit in such a listing, making Benford’s Law inapplicable.</p></li>
</ol>
<p>While Benford’s Law is not applicable to all datasets, it is generally applicable to large sets of naturally occurring numbers with some connection like:</p>
<ol style="list-style-type: decimal">
<li>Companies’ stock market values.</li>
<li>Data found in texts.</li>
<li>Demographic data, including state and city populations.</li>
<li>Income tax data.</li>
<li>Mathematical tables, like logarithms.</li>
<li>River drainage rates.</li>
<li>Scientific data.
(Benford, F)</li>
</ol>
</div>
<div id="applications-in-fraud-detection" class="section level3">
<h3>
<span class="header-section-number">17.2.2</span> Applications in Fraud Detection<a class="anchor" aria-label="anchor" href="#applications-in-fraud-detection"><i class="fas fa-link"></i></a>
</h3>
<p>One primary and practical use for Benford’s Law is fraud and error detection. It is expected that a large set of numbers will follow the law, so accountants, auditors, economists and tax professionals have a benchmark for what the normal levels of any particular number in a set are. Below are some famously documented examples of Benford’s Law being applied towards fraud detection (Frunza, 2015):</p>
<ol style="list-style-type: decimal">
<li>In the 1990s, an accountant named Mark Nigrini found that Benford’s law can be an effective red-flag test for fabricated tax returns. Authentic tax data usually follows Benford’s law, whereas made-up returns do not.</li>
<li>The law was used in 2001 to study economic data from Greece, with the implication that the country may have manipulated numbers to join the European Union.</li>
<li>Ponzi schemes can be detected using the law. Unrealistic returns, such as those purported by the Maddoff scam, fall far from the expected Benford probability distribution .</li>
</ol>
</div>
</div>
<div id="benford.analysis-package-in-r" class="section level2">
<h2>
<span class="header-section-number">17.3</span> benford.analysis package in r<a class="anchor" aria-label="anchor" href="#benford.analysis-package-in-r"><i class="fas fa-link"></i></a>
</h2>
<p>The Benford Analysis (benford.analysis) package provides tools that make it easier to validate data using Benford’s Law. The main purpose of the package is to identify suspicious data that may need further verification.</p>
<p>Documentation on the package can be found here:
<a href="https://cran.r-project.org/web/packages/benford.analysis/benford.analysis.pdf" class="uri">https://cran.r-project.org/web/packages/benford.analysis/benford.analysis.pdf</a></p>
<p>You can install the package from CRAN by running the following (uncommented):</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("benford.analysis")</span></span></code></pre></div>
<p>The package comes with 6 real datasets from Mark Nigrini’s book Benford’s Law: Applications for Forensic Accounting, Auditing, and Fraud Detection.</p>
<div id="example-usage-of-benford.analysis" class="section level3">
<h3>
<span class="header-section-number">17.3.1</span> Example Usage of benford.analysis<a class="anchor" aria-label="anchor" href="#example-usage-of-benford.analysis"><i class="fas fa-link"></i></a>
</h3>
<p>In this section we will give an example using 189,470 records from the corporate payments dataset which is provided with the package.</p>
<p>Load the package and data</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">corporate.payment</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">corporate.payment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   VendorNum       Date  InvNum Amount
## 1      2001 2010-01-02 0496J10  36.08
## 2      2001 2010-01-02 1726J10  77.80
## 3      2001 2010-01-02 2104J10  34.97
## 4      2001 2010-01-02 2445J10  59.00
## 5      2001 2010-01-02 3281J10  59.56
## 6      2001 2010-01-02 3822J10  50.38</code></pre>
<p>To validate the data against Benford’s law you simply use the function “benford” on the appropriate column:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bfd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/benford.analysis/man/benford.html">benford</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Amount</span><span class="op">)</span></span>
<span><span class="va">bfd</span></span></code></pre></div>
<pre><code>## 
## Benford object:
##  
## Data: df$Amount 
## Number of observations used = 185083 
## Number of obs. for second order = 65504 
## First digits analysed = 2
## 
## Mantissa: 
## 
##    Statistic  Value
##         Mean  0.496
##          Var  0.092
##  Ex.Kurtosis -1.257
##     Skewness -0.002
## 
## 
## The 5 largest deviations: 
## 
##   digits absolute.diff
## 1     50       5938.25
## 2     11       3331.98
## 3     10       2811.92
## 4     14       1043.68
## 5     98        889.95
## 
## Stats:
## 
##  Pearson's Chi-squared test
## 
## data:  df$Amount
## X-squared = 32094, df = 89, p-value &lt; 2.2e-16
## 
## 
##  Mantissa Arc Test
## 
## data:  df$Amount
## L2 = 0.0039958, df = 2, p-value &lt; 2.2e-16
## 
## Mean Absolute Deviation (MAD): 0.002336614
## MAD Conformity - Nigrini (2012): Nonconformity
## Distortion Factor: -1.065467
## 
## Remember: Real data will never conform perfectly to Benford's Law. You should not focus on p-values!</code></pre>
<p>This creates an object of class “Benford” with the results for the analysis using the first two significant digits by default.</p>
<p>Lets plot the bfd and observe the trends. Note that we running this analysis using the default parameters, i.e., no.of.digits = 2. This parameter can be modified if we only want to analyze the first digit .</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">bfd</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="benford_case_study_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></div>
<p>The original data is in blue and the expected frequency according to Benford’s law is in red.
In this example, the first plot shows that the data do have a tendency to follow Benford’s law.
There is also a clear outlier at 50.</p>
<p>The package also provides some helper functions to further investigate the data. For example, you can easily extract the observations with the largest discrepancies by using the “getSuspects” function.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">suspects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/benford.analysis/man/getSuspects.html">getSuspects</a></span><span class="op">(</span><span class="va">bfd</span>, <span class="va">df</span><span class="op">)</span></span>
<span><span class="va">suspects</span></span></code></pre></div>
<pre><code>##        VendorNum       Date       InvNum  Amount
##     1:      2001 2010-01-02      3822J10   50.38
##     2:      2001 2010-01-07     100107-2 1166.29
##     3:      2001 2010-01-08  11210084007 1171.45
##     4:      2001 2010-01-08      1585J10   50.42
##     5:      2001 2010-01-08      4733J10  113.34
##    ---                                          
## 17852:     52867 2010-07-01 270358343233   11.58
## 17853:     52870 2010-02-01 270682253025   11.20
## 17854:     52904 2010-06-01 271866383919   50.15
## 17855:     52911 2010-02-01 270957401515   11.20
## 17856:     52934 2010-02-01 271745237617   11.88</code></pre>
</div>
</div>
<div id="randomized-case-study" class="section level2">
<h2>
<span class="header-section-number">17.4</span> Randomized Case Study<a class="anchor" aria-label="anchor" href="#randomized-case-study"><i class="fas fa-link"></i></a>
</h2>
<div id="baseline-data-in-the-prior-section-we-saw-that-when-data-is-manipulated-with-static-values-clearly-the-first-digit-rule-is-broken.-but-what-about-when-data-is-randomly-manipulated" class="section level3">
<h3>
<span class="header-section-number">17.4.1</span> Baseline Data*
In the prior section we saw that when data is manipulated with static values, clearly the first digit rule is broken. But what about when data is randomly manipulated?<a class="anchor" aria-label="anchor" href="#baseline-data-in-the-prior-section-we-saw-that-when-data-is-manipulated-with-static-values-clearly-the-first-digit-rule-is-broken.-but-what-about-when-data-is-randomly-manipulated"><i class="fas fa-link"></i></a>
</h3>
<p>Let us try an experiment to see if we can use Benford’s Law to detect potential data manipulation where a bad actor randomly generated fake sales. For this experiment, our baseline will be also be using random data to highlight a point in the conclusion below. Let us pretend a company has sales data comprised of prices and quantities of items that they have sold. This code chunck sets up a data frame where one row is an recorded sale of a number of items sold at a set price.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">price</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1e3</span>, size <span class="op">=</span> <span class="fl">1e5</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">quantity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1e4</span>, size <span class="op">=</span> <span class="fl">1e5</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">price</span><span class="op">*</span><span class="va">quantity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>digit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   price quantity   value digit
## 1   171     9692 1657332     1
## 2   453      731  331143     3
## 3   974     3108 3027192     3
## 4   361     9287 3352607     3
## 5   269     5177 1392613     1
## 6   704     2207 1553728     1</code></pre>
<p>Now let us set up and see if this dataset exhibits the expected pattern for the first digit.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_group</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">digit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>count_percent <span class="op">=</span> <span class="va">count</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base_benford</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.31</span>,<span class="fl">.176</span>,<span class="fl">.125</span>,<span class="fl">.097</span>,<span class="fl">.079</span>,<span class="fl">.067</span>,<span class="fl">.058</span>,<span class="fl">.051</span>,<span class="fl">.046</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">base_benford</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'digit'</span>,<span class="st">'percent'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df_group</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">digit</span>, y<span class="op">=</span><span class="va">count_percent</span>, fill<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, fill<span class="op">=</span><span class="st">'lightblue'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">base_benford</span><span class="op">$</span><span class="va">digit</span>, y<span class="op">=</span><span class="va">base_benford</span><span class="op">$</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"First Digit of Randomized Sales"</span>,</span>
<span>              subtitle <span class="op">=</span> <span class="st">"Original Data (bar) vs Expected Benford (point)"</span>,</span>
<span>              <span class="co">#caption = "TBD",</span></span>
<span>              x <span class="op">=</span> <span class="st">"First Digit"</span>, y <span class="op">=</span> <span class="st">"% Occurance"</span>,</span>
<span>              <span class="co">#tag = "A"</span></span>
<span>              <span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="benford_case_study_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></div>
<p>The [value] of the sales exhibits some commonality with Benford’s Law but it is not exact as we see the first digit is not quite 30%. However there is still that decreasing probability of the leading digit. We will address some limitation in the next section. For now, let us try manipulating the data to see if any patterns change.</p>
</div>
<div id="manipulated-data" class="section level3">
<h3>
<span class="header-section-number">17.4.2</span> Manipulated Data<a class="anchor" aria-label="anchor" href="#manipulated-data"><i class="fas fa-link"></i></a>
</h3>
<p>In this next piece of code, we can pretend someone has entered in additional sales “randomly” by adding lots of relatively smaller sales under 100k.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">value2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1e6</span>, size <span class="op">=</span> <span class="fl">4e5</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">df_extra_sales</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="va">value2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df_extra_sales</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'price'</span>,<span class="st">'quantity'</span>,<span class="st">'value'</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">price</span><span class="op">*</span><span class="op">(</span><span class="va">quantity</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df_extra_sales</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>digit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_group2</span> <span class="op">&lt;-</span> <span class="va">df2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">digit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>count_percent <span class="op">=</span> <span class="va">count</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df_group2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">digit</span>, y<span class="op">=</span><span class="va">count_percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, fill<span class="op">=</span><span class="st">'lightblue'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">base_benford</span><span class="op">$</span><span class="va">digit</span>, y<span class="op">=</span><span class="va">base_benford</span><span class="op">$</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span></span></code></pre></div>
<div class="inline-figure"><img src="benford_case_study_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#gridExtra::grid.arrange(p1,p2, ncol=2)</span></span>
<span></span>
<span><span class="va">df_group_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">df_group</span><span class="op">$</span><span class="va">digit</span>,<span class="va">df_group</span><span class="op">$</span><span class="va">count_percent</span>,<span class="va">df_group2</span><span class="op">$</span><span class="va">count_percent</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df_group_combined</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'digit'</span>,<span class="st">'Original'</span>,<span class="st">'Manipulated'</span><span class="op">)</span></span>
<span><span class="va">df_group_combined</span> <span class="op">&lt;-</span> <span class="va">df_group_combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Original'</span>,<span class="st">'Manipulated'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df_group_combined</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'digit'</span>,<span class="st">'Dataset'</span>,<span class="st">'count_percent'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df_group_combined</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">digit</span>, y<span class="op">=</span><span class="va">count_percent</span>, fill<span class="op">=</span><span class="va">Dataset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position<span class="op">=</span><span class="st">'dodge'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"First Digit of Manipulated Sales"</span>,</span>
<span>              subtitle <span class="op">=</span> <span class="st">"Original Data vs Manipulated Data"</span>,</span>
<span>              x <span class="op">=</span> <span class="st">"First Digit"</span>, y <span class="op">=</span> <span class="st">"% Occurance"</span>,</span>
<span>              <span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="benford_case_study_files/figure-html/unnamed-chunk-9-2.png" width="672" style="display: block; margin: auto;"></div>
<p>From here we can see that adding sales randomly does change the distribution (when enough of them are added). But can we quantify this change? Let us use the benford package to cacluate some statistics. The following</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bfd_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/benford.analysis/man/benford.html">benford</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="co">#bfd_1</span></span>
<span></span>
<span><span class="va">bfd_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/benford.analysis/man/benford.html">benford</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="co">#bfd_2</span></span></code></pre></div>
<p>Printing the benford object creates verbose output so we have copied the main statistics below between the two dataframes:</p>
<ol style="list-style-type: decimal">
<li><p>df (original)
Statistic Value
Mean 0.526
Var 0.073
Ex.Kurtosis -1.048
Skewness -0.145</p></li>
<li><p>df2 (manipulated)
Statistic Value
Mean 0.65
Var 0.07
Ex.Kurtosis -0.59
Skewness -0.66</p></li>
</ol>
<p>If the data follows Benford’s Law, the expected statistics should be close to:
Statistic Value
Mean 0.5
Var 0.083
Ex.Kurtosis -1.2
Skewness 0</p>
<p>From a glance, it is evident that the statistics corresponding to the original df are much closer to the expected statistics than those from df2. In particular, the Ex.Kurtosis and Skewness differ significantly in df2 from the expected values. These are all indicators that the set of values deviate from the expected distribution corresponding to Benford’s Law.</p>
</div>
<div id="findings" class="section level3">
<h3>
<span class="header-section-number">17.4.3</span> Findings<a class="anchor" aria-label="anchor" href="#findings"><i class="fas fa-link"></i></a>
</h3>
<p>So what does this show us? If both sets were randomly generated, why would one not conform to Benford’s Law? One reason is that data that is the product of many random variables tends to exhibit a log-normal distribution which fits well with the first digit rule. However, by adding values in a static way, we change the data to be more uniform and distort the decaying curve.</p>
<p>Now it is important to understand that 1) this case is an extreme example to highlight a point, and 2) that Benford’s Law and its statistics do not prove anything - they only provide some guidance on areas that may look strange. In reality, forensic testing would be done on specific segments or accounts, people would be interviewed, systems and logs analyzed, etc. Similarly, even when Benford’s Law holds true, it does not mean there is no fraud; a bad actor that understands fraud detection methods will likely hide better.</p>
</div>
</div>
<div id="conclusion-2" class="section level2">
<h2>
<span class="header-section-number">17.5</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-2"><i class="fas fa-link"></i></a>
</h2>
<p>An important thing to note is that Benford’s law does not have a strict mathematical proof, and is simply a heuristic. It is a broad guideline which helps with the investigation of large data sets to see if they conform with the observed trends. A feature of a dataset that conforms with Benford’s Law is not proof of validity or vice versa. For this reason, a Benford analysis is usually conducted as a primary investigatory exercise, following which a more thorough investigation as described in the previous section is conducted.</p>
</div>
<div id="sources" class="section level2">
<h2>
<span class="header-section-number">17.6</span> Sources<a class="anchor" aria-label="anchor" href="#sources"><i class="fas fa-link"></i></a>
</h2>
<p>Benford, F. “The Law of Anomalous Numbers,” Proceedings of the American Philosophical Society, 78, 551–572. 1938.</p>
<p><a href="https://cran.r-project.org/web/packages/benford.analysis/benford.analysis.pdf" class="uri">https://cran.r-project.org/web/packages/benford.analysis/benford.analysis.pdf</a></p>
<p><a href="https://www.statisticshowto.com/benfords-law/" class="uri">https://www.statisticshowto.com/benfords-law/</a></p>
<p>Frunza, M. (2015). Solving Modern Crime in Financial Markets: Analytics and Case Studies. Academic Press.</p>
<p><a href="https://www.journalofaccountancy.com/issues/2017/apr/excel-and-benfords-law-to-detect-fraud.html#" class="uri">https://www.journalofaccountancy.com/issues/2017/apr/excel-and-benfords-law-to-detect-fraud.html#</a>:~:text=Briefly%20explained%2C%20Benford’s%20Law%20maintains,leading%20digit%20with%20decreasing%20frequency.</p>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="ten-interview-questions-and-answers.html"><span class="header-section-number">15</span> Ten interview questions and answers</a></div>
<div class="next"><a href="github-initial-setup.html"><span class="header-section-number">18</span> Github initial setup</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#benford-case-study"><span class="header-section-number">17</span> Benford Case Study</a></li>
<li><a class="nav-link" href="#contents"><span class="header-section-number">17.1</span> Contents</a></li>
<li>
<a class="nav-link" href="#introduction"><span class="header-section-number">17.2</span> Introduction</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#what-is-benfords-law"><span class="header-section-number">17.2.1</span> What is Benford’s Law?</a></li>
<li><a class="nav-link" href="#applications-in-fraud-detection"><span class="header-section-number">17.2.2</span> Applications in Fraud Detection</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#benford.analysis-package-in-r"><span class="header-section-number">17.3</span> benford.analysis package in r</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#example-usage-of-benford.analysis"><span class="header-section-number">17.3.1</span> Example Usage of benford.analysis</a></li></ul>
</li>
<li>
<a class="nav-link" href="#randomized-case-study"><span class="header-section-number">17.4</span> Randomized Case Study</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#baseline-data-in-the-prior-section-we-saw-that-when-data-is-manipulated-with-static-values-clearly-the-first-digit-rule-is-broken.-but-what-about-when-data-is-randomly-manipulated"><span class="header-section-number">17.4.1</span> Baseline Data*
In the prior section we saw that when data is manipulated with static values, clearly the first digit rule is broken. But what about when data is randomly manipulated?</a></li>
<li><a class="nav-link" href="#manipulated-data"><span class="header-section-number">17.4.2</span> Manipulated Data</a></li>
<li><a class="nav-link" href="#findings"><span class="header-section-number">17.4.3</span> Findings</a></li>
</ul>
</li>
<li><a class="nav-link" href="#conclusion-2"><span class="header-section-number">17.5</span> Conclusion</a></li>
<li><a class="nav-link" href="#sources"><span class="header-section-number">17.6</span> Sources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jtr13/cc22tt/blob/main/benford_case_study.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jtr13/cc22tt/edit/main/benford_case_study.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Community Contributions for EDAV Fall 2022 Tues/Thurs</strong>" was written by . It was last built on 2022-11-10.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
